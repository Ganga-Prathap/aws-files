{"filter":false,"title":"utils.py","tooltip":"/django/django_submissions/django_assignment_006/fb_post/utils.py","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":237,"column":12},"end":{"row":242,"column":16},"action":"insert","lines":["Post.objects.filter(","            posted_by_id=post_id).select_related(","                'posted_by'","                ).prefetch_related('reactions',","                Prefetch('comments',","                "],"id":404}],[{"start":{"row":236,"column":8},"end":{"row":236,"column":12},"action":"remove","lines":["    "],"id":405}],[{"start":{"row":241,"column":24},"end":{"row":241,"column":25},"action":"remove","lines":["("],"id":406},{"start":{"row":241,"column":23},"end":{"row":241,"column":24},"action":"remove","lines":["h"]},{"start":{"row":241,"column":22},"end":{"row":241,"column":23},"action":"remove","lines":["c"]},{"start":{"row":241,"column":21},"end":{"row":241,"column":22},"action":"remove","lines":["t"]},{"start":{"row":241,"column":20},"end":{"row":241,"column":21},"action":"remove","lines":["e"]},{"start":{"row":241,"column":19},"end":{"row":241,"column":20},"action":"remove","lines":["f"]},{"start":{"row":241,"column":18},"end":{"row":241,"column":19},"action":"remove","lines":["e"]},{"start":{"row":241,"column":17},"end":{"row":241,"column":18},"action":"remove","lines":["r"]},{"start":{"row":241,"column":16},"end":{"row":241,"column":17},"action":"remove","lines":["P"]}],[{"start":{"row":241,"column":25},"end":{"row":241,"column":26},"action":"insert","lines":["_"],"id":407},{"start":{"row":241,"column":26},"end":{"row":241,"column":27},"action":"insert","lines":["_"]},{"start":{"row":241,"column":27},"end":{"row":241,"column":28},"action":"insert","lines":["c"]},{"start":{"row":241,"column":28},"end":{"row":241,"column":29},"action":"insert","lines":["o"]},{"start":{"row":241,"column":29},"end":{"row":241,"column":30},"action":"insert","lines":["m"]},{"start":{"row":241,"column":30},"end":{"row":241,"column":31},"action":"insert","lines":["m"]},{"start":{"row":241,"column":31},"end":{"row":241,"column":32},"action":"insert","lines":["e"]},{"start":{"row":241,"column":32},"end":{"row":241,"column":33},"action":"insert","lines":["n"]},{"start":{"row":241,"column":33},"end":{"row":241,"column":34},"action":"insert","lines":["t"]}],[{"start":{"row":241,"column":34},"end":{"row":241,"column":35},"action":"insert","lines":["e"],"id":408},{"start":{"row":241,"column":35},"end":{"row":241,"column":36},"action":"insert","lines":["d"]},{"start":{"row":241,"column":36},"end":{"row":241,"column":37},"action":"insert","lines":["_"]},{"start":{"row":241,"column":37},"end":{"row":241,"column":38},"action":"insert","lines":["b"]},{"start":{"row":241,"column":38},"end":{"row":241,"column":39},"action":"insert","lines":["y"]}],[{"start":{"row":241,"column":41},"end":{"row":242,"column":0},"action":"insert","lines":["",""],"id":409},{"start":{"row":242,"column":0},"end":{"row":242,"column":16},"action":"insert","lines":["                "]},{"start":{"row":242,"column":16},"end":{"row":242,"column":17},"action":"insert","lines":["'"]}],[{"start":{"row":242,"column":17},"end":{"row":242,"column":18},"action":"insert","lines":["c"],"id":410},{"start":{"row":242,"column":18},"end":{"row":242,"column":19},"action":"insert","lines":["o"]},{"start":{"row":242,"column":19},"end":{"row":242,"column":20},"action":"insert","lines":["m"]},{"start":{"row":242,"column":20},"end":{"row":242,"column":21},"action":"insert","lines":["m"]},{"start":{"row":242,"column":21},"end":{"row":242,"column":22},"action":"insert","lines":["e"]},{"start":{"row":242,"column":22},"end":{"row":242,"column":23},"action":"insert","lines":["n"]},{"start":{"row":242,"column":23},"end":{"row":242,"column":24},"action":"insert","lines":["t"]},{"start":{"row":242,"column":24},"end":{"row":242,"column":25},"action":"insert","lines":["s"]}],[{"start":{"row":242,"column":25},"end":{"row":242,"column":26},"action":"insert","lines":["_"],"id":411},{"start":{"row":242,"column":26},"end":{"row":242,"column":27},"action":"insert","lines":["_"]}],[{"start":{"row":242,"column":27},"end":{"row":242,"column":28},"action":"insert","lines":["r"],"id":412},{"start":{"row":242,"column":28},"end":{"row":242,"column":29},"action":"insert","lines":["e"]},{"start":{"row":242,"column":29},"end":{"row":242,"column":30},"action":"insert","lines":["a"]},{"start":{"row":242,"column":30},"end":{"row":242,"column":31},"action":"insert","lines":["c"]},{"start":{"row":242,"column":31},"end":{"row":242,"column":32},"action":"insert","lines":["t"]},{"start":{"row":242,"column":32},"end":{"row":242,"column":33},"action":"insert","lines":["i"]},{"start":{"row":242,"column":33},"end":{"row":242,"column":34},"action":"insert","lines":["o"]},{"start":{"row":242,"column":34},"end":{"row":242,"column":35},"action":"insert","lines":["n"]},{"start":{"row":242,"column":35},"end":{"row":242,"column":36},"action":"insert","lines":["s"]}],[{"start":{"row":242,"column":36},"end":{"row":242,"column":37},"action":"insert","lines":["'"],"id":413}],[{"start":{"row":242,"column":37},"end":{"row":242,"column":38},"action":"insert","lines":[")"],"id":414}],[{"start":{"row":242,"column":38},"end":{"row":242,"column":39},"action":"insert","lines":[")"],"id":415}],[{"start":{"row":242,"column":38},"end":{"row":242,"column":39},"action":"remove","lines":[")"],"id":416}],[{"start":{"row":244,"column":8},"end":{"row":244,"column":12},"action":"remove","lines":["    "],"id":417}],[{"start":{"row":80,"column":12},"end":{"row":80,"column":16},"action":"remove","lines":["    "],"id":418}],[{"start":{"row":86,"column":8},"end":{"row":86,"column":12},"action":"remove","lines":["    "],"id":419}],[{"start":{"row":16,"column":8},"end":{"row":16,"column":9},"action":"insert","lines":["#"],"id":420}],[{"start":{"row":16,"column":8},"end":{"row":16,"column":9},"action":"remove","lines":["#"],"id":421}],[{"start":{"row":34,"column":7},"end":{"row":34,"column":8},"action":"insert","lines":["#"],"id":422}],[{"start":{"row":34,"column":7},"end":{"row":34,"column":8},"action":"remove","lines":["#"],"id":423}],[{"start":{"row":16,"column":8},"end":{"row":16,"column":9},"action":"insert","lines":["#"],"id":424}],[{"start":{"row":15,"column":13},"end":{"row":16,"column":0},"action":"insert","lines":["",""],"id":425},{"start":{"row":16,"column":0},"end":{"row":16,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":16,"column":8},"end":{"row":16,"column":12},"action":"remove","lines":["    "],"id":426}],[{"start":{"row":16,"column":8},"end":{"row":16,"column":9},"action":"insert","lines":["p"],"id":427},{"start":{"row":16,"column":9},"end":{"row":16,"column":10},"action":"insert","lines":["r"]},{"start":{"row":16,"column":10},"end":{"row":16,"column":11},"action":"insert","lines":["i"]},{"start":{"row":16,"column":11},"end":{"row":16,"column":12},"action":"insert","lines":["n"]},{"start":{"row":16,"column":12},"end":{"row":16,"column":13},"action":"insert","lines":["t"]}],[{"start":{"row":16,"column":13},"end":{"row":16,"column":15},"action":"insert","lines":["()"],"id":428}],[{"start":{"row":16,"column":14},"end":{"row":16,"column":15},"action":"insert","lines":["p"],"id":429},{"start":{"row":16,"column":15},"end":{"row":16,"column":16},"action":"insert","lines":["o"]},{"start":{"row":16,"column":16},"end":{"row":16,"column":17},"action":"insert","lines":["s"]},{"start":{"row":16,"column":17},"end":{"row":16,"column":18},"action":"insert","lines":["t"]},{"start":{"row":16,"column":18},"end":{"row":16,"column":19},"action":"insert","lines":["."]},{"start":{"row":16,"column":19},"end":{"row":16,"column":20},"action":"insert","lines":["i"]},{"start":{"row":16,"column":20},"end":{"row":16,"column":21},"action":"insert","lines":["d"]}],[{"start":{"row":16,"column":21},"end":{"row":16,"column":22},"action":"remove","lines":[")"],"id":430},{"start":{"row":16,"column":20},"end":{"row":16,"column":21},"action":"remove","lines":["d"]},{"start":{"row":16,"column":19},"end":{"row":16,"column":20},"action":"remove","lines":["i"]},{"start":{"row":16,"column":18},"end":{"row":16,"column":19},"action":"remove","lines":["."]},{"start":{"row":16,"column":17},"end":{"row":16,"column":18},"action":"remove","lines":["t"]},{"start":{"row":16,"column":16},"end":{"row":16,"column":17},"action":"remove","lines":["s"]},{"start":{"row":16,"column":15},"end":{"row":16,"column":16},"action":"remove","lines":["o"]},{"start":{"row":16,"column":14},"end":{"row":16,"column":15},"action":"remove","lines":["p"]},{"start":{"row":16,"column":13},"end":{"row":16,"column":14},"action":"remove","lines":["("]},{"start":{"row":16,"column":12},"end":{"row":16,"column":13},"action":"remove","lines":["t"]},{"start":{"row":16,"column":11},"end":{"row":16,"column":12},"action":"remove","lines":["n"]},{"start":{"row":16,"column":10},"end":{"row":16,"column":11},"action":"remove","lines":["i"]},{"start":{"row":16,"column":9},"end":{"row":16,"column":10},"action":"remove","lines":["r"]},{"start":{"row":16,"column":8},"end":{"row":16,"column":9},"action":"remove","lines":["p"]},{"start":{"row":16,"column":4},"end":{"row":16,"column":8},"action":"remove","lines":["    "]},{"start":{"row":16,"column":0},"end":{"row":16,"column":4},"action":"remove","lines":["    "]},{"start":{"row":15,"column":13},"end":{"row":16,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":15,"column":13},"end":{"row":16,"column":0},"action":"insert","lines":["",""],"id":431},{"start":{"row":16,"column":0},"end":{"row":16,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":16,"column":8},"end":{"row":16,"column":12},"action":"remove","lines":["    "],"id":432}],[{"start":{"row":16,"column":8},"end":{"row":16,"column":9},"action":"insert","lines":["p"],"id":433},{"start":{"row":16,"column":9},"end":{"row":16,"column":10},"action":"insert","lines":["r"]},{"start":{"row":16,"column":10},"end":{"row":16,"column":11},"action":"insert","lines":["i"]},{"start":{"row":16,"column":11},"end":{"row":16,"column":12},"action":"insert","lines":["n"]},{"start":{"row":16,"column":12},"end":{"row":16,"column":13},"action":"insert","lines":["t"]}],[{"start":{"row":16,"column":13},"end":{"row":16,"column":15},"action":"insert","lines":["()"],"id":434}],[{"start":{"row":16,"column":14},"end":{"row":16,"column":16},"action":"insert","lines":["\"\""],"id":435}],[{"start":{"row":16,"column":15},"end":{"row":16,"column":16},"action":"insert","lines":["h"],"id":436},{"start":{"row":16,"column":16},"end":{"row":16,"column":17},"action":"insert","lines":["e"]},{"start":{"row":16,"column":17},"end":{"row":16,"column":18},"action":"insert","lines":["l"]},{"start":{"row":16,"column":18},"end":{"row":16,"column":19},"action":"insert","lines":["l"]},{"start":{"row":16,"column":19},"end":{"row":16,"column":20},"action":"insert","lines":["o"]}],[{"start":{"row":16,"column":8},"end":{"row":16,"column":9},"action":"insert","lines":["@"],"id":437}],[{"start":{"row":16,"column":8},"end":{"row":16,"column":9},"action":"remove","lines":["@"],"id":438}],[{"start":{"row":16,"column":8},"end":{"row":16,"column":9},"action":"insert","lines":["#"],"id":439}],[{"start":{"row":17,"column":8},"end":{"row":17,"column":9},"action":"remove","lines":["#"],"id":440}],[{"start":{"row":17,"column":8},"end":{"row":17,"column":9},"action":"insert","lines":["#"],"id":441}],[{"start":{"row":16,"column":22},"end":{"row":16,"column":23},"action":"remove","lines":[")"],"id":442},{"start":{"row":16,"column":21},"end":{"row":16,"column":22},"action":"remove","lines":["\""]},{"start":{"row":16,"column":20},"end":{"row":16,"column":21},"action":"remove","lines":["o"]},{"start":{"row":16,"column":19},"end":{"row":16,"column":20},"action":"remove","lines":["l"]},{"start":{"row":16,"column":18},"end":{"row":16,"column":19},"action":"remove","lines":["l"]},{"start":{"row":16,"column":17},"end":{"row":16,"column":18},"action":"remove","lines":["e"]},{"start":{"row":16,"column":16},"end":{"row":16,"column":17},"action":"remove","lines":["h"]},{"start":{"row":16,"column":15},"end":{"row":16,"column":16},"action":"remove","lines":["\""]},{"start":{"row":16,"column":14},"end":{"row":16,"column":15},"action":"remove","lines":["("]},{"start":{"row":16,"column":13},"end":{"row":16,"column":14},"action":"remove","lines":["t"]},{"start":{"row":16,"column":12},"end":{"row":16,"column":13},"action":"remove","lines":["n"]},{"start":{"row":16,"column":11},"end":{"row":16,"column":12},"action":"remove","lines":["i"]},{"start":{"row":16,"column":10},"end":{"row":16,"column":11},"action":"remove","lines":["r"]},{"start":{"row":16,"column":9},"end":{"row":16,"column":10},"action":"remove","lines":["p"]},{"start":{"row":16,"column":8},"end":{"row":16,"column":9},"action":"remove","lines":["#"]},{"start":{"row":16,"column":4},"end":{"row":16,"column":8},"action":"remove","lines":["    "]}],[{"start":{"row":16,"column":0},"end":{"row":16,"column":4},"action":"remove","lines":["    "],"id":443}],[{"start":{"row":15,"column":13},"end":{"row":16,"column":0},"action":"remove","lines":["",""],"id":444}],[{"start":{"row":16,"column":8},"end":{"row":16,"column":9},"action":"remove","lines":["#"],"id":445}],[{"start":{"row":210,"column":0},"end":{"row":210,"column":1},"action":"remove","lines":[" "],"id":446}],[{"start":{"row":210,"column":0},"end":{"row":210,"column":2},"action":"insert","lines":["''"],"id":447}],[{"start":{"row":210,"column":2},"end":{"row":210,"column":3},"action":"insert","lines":["'"],"id":448}],[{"start":{"row":341,"column":0},"end":{"row":341,"column":2},"action":"insert","lines":["''"],"id":449}],[{"start":{"row":341,"column":2},"end":{"row":341,"column":3},"action":"insert","lines":["'"],"id":450}],[{"start":{"row":341,"column":3},"end":{"row":342,"column":0},"action":"insert","lines":["",""],"id":451},{"start":{"row":342,"column":0},"end":{"row":343,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":343,"column":0},"end":{"row":344,"column":0},"action":"insert","lines":["",""],"id":452},{"start":{"row":344,"column":0},"end":{"row":345,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":342,"column":0},"end":{"row":454,"column":0},"action":"insert","lines":["def get_comment_reactions(comment):","    comment_reactions = []","    for react in list(comment.reactions.all()):","        if react.reaction not in comment_reactions:","            comment_reactions.append(react.reaction)","    return comment_reactions","","def get_comment_replies2(comment_reply):","    reply_reactions_list = get_comment_reactions(comment_reply)","    cr_time = comment_reply.commented_at.strftime('%Y-%m-%d %H:%M:%S.%f')","    replies_dict = {","            'comment_id': comment_reply.id,","            'commenter': {","                'user_id': comment_reply.commented_by_id,","                'name': comment_reply.commented_by.name,","                'profile_pic': comment_reply.commented_by.profile_pic","            },","            'commented_at': cr_time,","            'comment_content': comment_reply.content,","            'reactions': {","                'count': len(reply_reactions_list),","                'type': reply_reactions_list","            },","        }","    return replies_dict","","def get_comment_replies(comment, post_comments):","    replies_list = []","    comments_list = []","    for comments in post_comments:","        if comment.id == comments.parent_comment_id:","            comments_list.append(comments)","","    for comment_reply in comments_list:","        replies_list.append(get_comment_replies2(comment_reply))","    return replies_list","","def get_post_comments2(comment, post_comments):","    replies_list = get_comment_replies(comment, post_comments)","    comment_react_list = get_comment_reactions(comment)","","    comment_dict = {","        'comment_id': comment.id,","        'commenter': {","            'user_id': comment.commented_by_id,","            'name': comment.commented_by.name,","            'profile_pic': comment.commented_by.profile_pic","        },","        'commented_at': comment.commented_at.strftime('%Y-%m-%d %H:%M:%S.%f'),","        'comment_content': comment.content,","        'reactions': {","            'count': len(comment_react_list),","            'type': comment_react_list","        },","        'replies_count': len(replies_list),","        'replies': replies_list,","    }","    return comment_dict","","def get_post_comments(post_comments):","    comment_list = []","    for comment in post_comments:","","        if not comment.parent_comment_id:","            comment_dict = get_post_comments2(comment, post_comments)","        comment_list.append(comment_dict)","    return comment_list","","","","def get_post_details(post):","    post_comments = list(post.comments.all())","    comment_list = get_post_comments(post_comments)","    post_react_list = []","    for react in list(post.reactions.all()):","        if react.reaction not in post_react_list:","            post_react_list.append(react.reaction)","","    post_dict = {","        'post_id': post.id,","        'posted_by': {","            'name': post.posted_by.name,","            'user_id': post.posted_by_id,","            'profile_pic': post.posted_by.profile_pic","            },","        'posted_at': post.posted_at.strftime('%Y-%m-%d %H:%M:%S.%f'),","        'post_content': post.content,","        'reactions': {","            'count': post.reactions.count(),","            'type': post_react_list,","        },","        'comments': comment_list,","        'comments_count': len(comment_list),","    }","    return post_dict","","# Task-13","def get_post(post_id):","","    post = Post.objects.filter(id=post_id)","","    if not post:","        raise InvalidPostException","","    posts = Post.objects.filter(","        id=post_id).select_related('posted_by').prefetch_related(","            'reactions', Prefetch(","                'comments', queryset=Comment.objects.select_related(","                    'commented_by').prefetch_related('reactions')))","","    for post in posts:","        return get_post_details(post)",""],"id":453}],[{"start":{"row":405,"column":14},"end":{"row":405,"column":15},"action":"remove","lines":[" "],"id":454},{"start":{"row":405,"column":13},"end":{"row":405,"column":14},"action":"remove","lines":["t"]},{"start":{"row":405,"column":12},"end":{"row":405,"column":13},"action":"remove","lines":["o"]},{"start":{"row":405,"column":11},"end":{"row":405,"column":12},"action":"remove","lines":["n"]}],[{"start":{"row":405,"column":36},"end":{"row":405,"column":37},"action":"insert","lines":[" "],"id":455},{"start":{"row":405,"column":37},"end":{"row":405,"column":38},"action":"insert","lines":["="]},{"start":{"row":405,"column":38},"end":{"row":405,"column":39},"action":"insert","lines":["="]}],[{"start":{"row":405,"column":39},"end":{"row":405,"column":40},"action":"insert","lines":[" "],"id":456},{"start":{"row":405,"column":40},"end":{"row":405,"column":41},"action":"insert","lines":["N"]},{"start":{"row":405,"column":41},"end":{"row":405,"column":42},"action":"insert","lines":["o"]},{"start":{"row":405,"column":42},"end":{"row":405,"column":43},"action":"insert","lines":["n"]},{"start":{"row":405,"column":43},"end":{"row":405,"column":44},"action":"insert","lines":["e"]}],[{"start":{"row":407,"column":8},"end":{"row":407,"column":12},"action":"insert","lines":["    "],"id":457}],[{"start":{"row":405,"column":43},"end":{"row":405,"column":44},"action":"remove","lines":["e"],"id":458},{"start":{"row":405,"column":42},"end":{"row":405,"column":43},"action":"remove","lines":["n"]},{"start":{"row":405,"column":41},"end":{"row":405,"column":42},"action":"remove","lines":["o"]},{"start":{"row":405,"column":40},"end":{"row":405,"column":41},"action":"remove","lines":["N"]},{"start":{"row":405,"column":39},"end":{"row":405,"column":40},"action":"remove","lines":[" "]},{"start":{"row":405,"column":38},"end":{"row":405,"column":39},"action":"remove","lines":["="]},{"start":{"row":405,"column":37},"end":{"row":405,"column":38},"action":"remove","lines":["="]},{"start":{"row":405,"column":36},"end":{"row":405,"column":37},"action":"remove","lines":[" "]}],[{"start":{"row":405,"column":11},"end":{"row":405,"column":12},"action":"insert","lines":["n"],"id":459},{"start":{"row":405,"column":12},"end":{"row":405,"column":13},"action":"insert","lines":["o"]},{"start":{"row":405,"column":13},"end":{"row":405,"column":14},"action":"insert","lines":["t"]}],[{"start":{"row":405,"column":14},"end":{"row":405,"column":15},"action":"insert","lines":[" "],"id":460}],[{"start":{"row":437,"column":0},"end":{"row":437,"column":2},"action":"insert","lines":["''"],"id":461}],[{"start":{"row":437,"column":2},"end":{"row":437,"column":3},"action":"insert","lines":["'"],"id":462}],[{"start":{"row":210,"column":3},"end":{"row":210,"column":4},"action":"remove","lines":[" "],"id":463},{"start":{"row":210,"column":2},"end":{"row":210,"column":3},"action":"remove","lines":["'"]},{"start":{"row":210,"column":1},"end":{"row":210,"column":2},"action":"remove","lines":["'"]},{"start":{"row":210,"column":0},"end":{"row":210,"column":1},"action":"remove","lines":["'"]}],[{"start":{"row":341,"column":0},"end":{"row":342,"column":0},"action":"insert","lines":["",""],"id":464}],[{"start":{"row":339,"column":36},"end":{"row":339,"column":37},"action":"insert","lines":[" "],"id":465}],[{"start":{"row":438,"column":2},"end":{"row":438,"column":3},"action":"remove","lines":["'"],"id":466},{"start":{"row":438,"column":1},"end":{"row":438,"column":2},"action":"remove","lines":["'"]},{"start":{"row":438,"column":0},"end":{"row":438,"column":1},"action":"remove","lines":["'"]}],[{"start":{"row":456,"column":0},"end":{"row":456,"column":2},"action":"insert","lines":["''"],"id":467}],[{"start":{"row":456,"column":2},"end":{"row":456,"column":3},"action":"insert","lines":["'"],"id":468}],[{"start":{"row":456,"column":2},"end":{"row":456,"column":3},"action":"remove","lines":["'"],"id":469},{"start":{"row":456,"column":1},"end":{"row":456,"column":2},"action":"remove","lines":["'"]},{"start":{"row":456,"column":0},"end":{"row":456,"column":1},"action":"remove","lines":["'"]}],[{"start":{"row":210,"column":0},"end":{"row":210,"column":1},"action":"remove","lines":[" "],"id":470}],[{"start":{"row":210,"column":0},"end":{"row":210,"column":2},"action":"insert","lines":["''"],"id":471}],[{"start":{"row":210,"column":2},"end":{"row":210,"column":3},"action":"insert","lines":["'"],"id":472}],[{"start":{"row":210,"column":2},"end":{"row":210,"column":3},"action":"remove","lines":["'"],"id":473},{"start":{"row":210,"column":1},"end":{"row":210,"column":2},"action":"remove","lines":["'"]},{"start":{"row":210,"column":0},"end":{"row":210,"column":1},"action":"remove","lines":["'"]}],[{"start":{"row":210,"column":0},"end":{"row":210,"column":2},"action":"insert","lines":["''"],"id":474}],[{"start":{"row":210,"column":2},"end":{"row":210,"column":3},"action":"insert","lines":["'"],"id":475}],[{"start":{"row":210,"column":2},"end":{"row":210,"column":3},"action":"remove","lines":["'"],"id":476},{"start":{"row":210,"column":1},"end":{"row":210,"column":2},"action":"remove","lines":["'"]},{"start":{"row":210,"column":0},"end":{"row":210,"column":1},"action":"remove","lines":["'"]}],[{"start":{"row":456,"column":0},"end":{"row":456,"column":2},"action":"insert","lines":["''"],"id":477}],[{"start":{"row":456,"column":2},"end":{"row":456,"column":3},"action":"insert","lines":["'"],"id":478}],[{"start":{"row":340,"column":25},"end":{"row":341,"column":0},"action":"insert","lines":["",""],"id":479},{"start":{"row":341,"column":0},"end":{"row":341,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":341,"column":4},"end":{"row":341,"column":8},"action":"remove","lines":["    "],"id":480},{"start":{"row":341,"column":0},"end":{"row":341,"column":4},"action":"remove","lines":["    "]}],[{"start":{"row":341,"column":0},"end":{"row":341,"column":2},"action":"insert","lines":["''"],"id":481}],[{"start":{"row":341,"column":2},"end":{"row":341,"column":3},"action":"insert","lines":["'"],"id":482}],[{"start":{"row":332,"column":27},"end":{"row":333,"column":0},"action":"insert","lines":["",""],"id":483},{"start":{"row":333,"column":0},"end":{"row":333,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":333,"column":4},"end":{"row":333,"column":8},"action":"remove","lines":["    "],"id":484},{"start":{"row":333,"column":0},"end":{"row":333,"column":4},"action":"remove","lines":["    "]}],[{"start":{"row":333,"column":0},"end":{"row":333,"column":1},"action":"insert","lines":[";"],"id":485}],[{"start":{"row":333,"column":0},"end":{"row":333,"column":1},"action":"remove","lines":[";"],"id":486}],[{"start":{"row":333,"column":0},"end":{"row":333,"column":2},"action":"insert","lines":["''"],"id":487}],[{"start":{"row":333,"column":2},"end":{"row":333,"column":3},"action":"insert","lines":["'"],"id":488}],[{"start":{"row":342,"column":2},"end":{"row":342,"column":3},"action":"remove","lines":["'"],"id":489},{"start":{"row":342,"column":1},"end":{"row":342,"column":2},"action":"remove","lines":["'"]},{"start":{"row":342,"column":0},"end":{"row":342,"column":1},"action":"remove","lines":["'"]}],[{"start":{"row":333,"column":2},"end":{"row":333,"column":3},"action":"remove","lines":["'"],"id":490},{"start":{"row":333,"column":1},"end":{"row":333,"column":2},"action":"remove","lines":["'"]},{"start":{"row":333,"column":0},"end":{"row":333,"column":1},"action":"remove","lines":["'"]}],[{"start":{"row":333,"column":0},"end":{"row":333,"column":2},"action":"insert","lines":["''"],"id":491}],[{"start":{"row":333,"column":2},"end":{"row":333,"column":3},"action":"insert","lines":["'"],"id":492}],[{"start":{"row":342,"column":0},"end":{"row":342,"column":2},"action":"insert","lines":["''"],"id":493}],[{"start":{"row":342,"column":2},"end":{"row":342,"column":3},"action":"insert","lines":["'"],"id":494}],[{"start":{"row":485,"column":27},"end":{"row":486,"column":0},"action":"insert","lines":["",""],"id":495},{"start":{"row":486,"column":0},"end":{"row":486,"column":8},"action":"insert","lines":["        "]},{"start":{"row":486,"column":8},"end":{"row":487,"column":0},"action":"insert","lines":["",""]},{"start":{"row":487,"column":0},"end":{"row":487,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":487,"column":4},"end":{"row":487,"column":8},"action":"remove","lines":["    "],"id":496},{"start":{"row":487,"column":0},"end":{"row":487,"column":4},"action":"remove","lines":["    "]}],[{"start":{"row":487,"column":0},"end":{"row":592,"column":0},"action":"insert","lines":["def get_comment_reactions(comment):","    comment_reactions = []","    for react in list(comment.reactions.all()):","        if react.reaction not in comment_reactions:","            comment_reactions.append(react.reaction)","    return comment_reactions","","def get_comment_replies2(comment):","    reply_reactions_list = get_comment_reactions(comment)","    replies_dict = {","        'comment_id': comment.id,","        'commenter': {","            'user_id': comment.commented_by_id,","            'name': comment.commented_by.name,","            'profile_pic': comment.commented_by.profile_pic","        },","        'commented_at': comment.commented_at.strftime('%Y-%m-%d %H:%M:%S.%f'),","        'comment_content': comment.content,","        'reactions': {","            'count': len(reply_reactions_list),","            'type': reply_reactions_list","        },","    }","    return replies_dict","","def get_comment_replies(comment, post_comments):","    replies_list = []","    comments_list = []","    for comments in post_comments:","        if comment.id == comments.parent_comment_id:","            comments_list.append(comments)","","    for comment_reply in comments_list:","        replies_list.append(get_comment_replies2(comment_reply))","    return replies_list","","def get_post_comments2(comment, post_comments):","    replies_list = get_comment_replies(comment, post_comments)","    comment_react_list = get_comment_reactions(comment)","","    comment_dict = {","        'comment_id': comment.id,","        'commenter': {","            'user_id': comment.commented_by_id,","            'name': comment.commented_by.name,","            'profile_pic': comment.commented_by.profile_pic","        },","        'commented_at': comment.commented_at.strftime('%Y-%m-%d %H:%M:%S.%f'),","        'comment_content': comment.content,","        'reactions': {","            'count': len(comment_react_list),","            'type': comment_react_list","        },","        'replies_count': len(replies_list),","        'replies': replies_list,","    }","    return comment_dict","","def get_post_comments(post_comments):","    comment_list = []","    for comment in post_comments:","","        if not comment.parent_comment_id:","            comment_dict = get_post_comments2(comment, post_comments)","            comment_list.append(comment_dict)","    return comment_list","","def get_post_details(post):","    post_comments = list(post.comments.all())","    comment_list = get_post_comments(post_comments)","    post_react_list = []","    for react in list(post.reactions.all()):","        if react.reaction not in post_react_list:","            post_react_list.append(react.reaction)","    post_dict = {","        'post_id': post.id,","        'posted_by': {","            'name': post.posted_by.name,","            'user_id': post.posted_by_id,","            'profile_pic': post.posted_by.profile_pic},","        'posted_at': post.posted_at.strftime('%Y-%m-%d %H:%M:%S.%f'),","        'post_content': post.content,","        'reactions': {","            'count': post.reactions.count(),","            'type': post_react_list,},","        'comments': comment_list,","        'comments_count': len(comment_list),}","    return post_dict","","","# Task-14","def get_user_posts(user_id):","    user = User.objects.filter(id=user_id)","    if not user:","        raise InvalidUserException","    posts = Post.objects.filter(","        posted_by_id=user_id).select_related('posted_by').prefetch_related(","            'reactions', Prefetch(","                'comments', queryset=Comment.objects.select_related(","                    'commented_by').prefetch_related('reactions')))","    post_list = []","","    for post in posts:","        post_list.append(get_post_details(post))","    return post_list",""],"id":497}],[{"start":{"row":486,"column":0},"end":{"row":486,"column":1},"action":"remove","lines":[" "],"id":498}],[{"start":{"row":486,"column":0},"end":{"row":486,"column":2},"action":"insert","lines":["''"],"id":499}],[{"start":{"row":486,"column":2},"end":{"row":486,"column":3},"action":"insert","lines":["'"],"id":500}],[{"start":{"row":592,"column":0},"end":{"row":592,"column":2},"action":"insert","lines":["''"],"id":501}],[{"start":{"row":592,"column":2},"end":{"row":592,"column":3},"action":"insert","lines":["'"],"id":502}],[{"start":{"row":333,"column":2},"end":{"row":333,"column":3},"action":"remove","lines":["'"],"id":503},{"start":{"row":333,"column":1},"end":{"row":333,"column":2},"action":"remove","lines":["'"]},{"start":{"row":333,"column":0},"end":{"row":333,"column":1},"action":"remove","lines":["'"]}],[{"start":{"row":342,"column":2},"end":{"row":342,"column":3},"action":"remove","lines":["'"],"id":504},{"start":{"row":342,"column":1},"end":{"row":342,"column":2},"action":"remove","lines":["'"]},{"start":{"row":342,"column":0},"end":{"row":342,"column":1},"action":"remove","lines":["'"]}]]},"ace":{"folds":[],"scrolltop":3060,"scrollleft":0,"selection":{"start":{"row":242,"column":33},"end":{"row":242,"column":33},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":1,"state":"start","mode":"ace/mode/python"}},"timestamp":1587706307132,"hash":"9a506fbbcab1a8f9d6a68630a8625a7b2486fac0"}